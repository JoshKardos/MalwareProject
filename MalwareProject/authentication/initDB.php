<?php
require_once 'mysql_parameter.php';

$conn = mysqli_connect($hn, $un, $pw, $db, $port);
if ($conn->connect_error) die($conn->connect_error);

// create an user table
$create_user = "CREATE TABLE users (
    id int(11) NOT NULL AUTO_INCREMENT,
    username varchar(100) NOT NULL,
    email varchar(100) NOT NULL,
    password varchar(100) NOT NULL,
    PRIMARY KEY (id),
    UNIQUE KEY username (username)
)";

$user_result = $conn->query($create_user);

if (!$user_result) {
	die($connection->error);
	echo "create user table failed";
}
$user_result->close();

// creat an admin table
$create_admin = "CREATE TABLE admins (
    id int(11) NOT NULL AUTO_INCREMENT,
    username varchar(100) DEFAULT NULL,
    email varchar(100) DEFAULT NULL,
    password varchar(100) DEFAULT NULL,
    PRIMARY KEY (id),
    UNIQUE KEY username (username)
)";

$admin_result = $conn->query($create_admin);

if (!$admin_result) {
	die($connection->error);
	echo "create admin table failed";
}
$admin_result->close();

// insert an admin account
$insert_admin = "INSERT INTO admins 
    (username, email, password) 
    VALUES('admin', 'admin@gmail.com', '7a0a86642dd1ae29ed0b64d1c9319be8')
)";
// admin user 
// name: admin; 
// password: !1Qq

$insert_admin_result = $conn->query($insert_admin);

if (!$insert_admin_result) {
	die($conn->error);
	echo "Insert an admin account failed";
}
$insert_admin_result->close();

// create a contibutor table
$create_contibutor = "CREATE TABLE contributors (
    id int(11) NOT NULL AUTO_INCREMENT,
    username varchar(100) NOT NULL,
    email varchar(100) NOT NULL,
    password varchar(100) NOT NULL,
    PRIMARY KEY (id),
    UNIQUE KEY username (username)
)";

$admin_result = $conn->query($create_contibutor);

if (!$admin_result) {
	die($conn->error);
	echo "create contributor table failed";
}
$admin_result->close();

// create a malware table
$create_malware = "CREATE TABLE malwares (
    id smallint(5) unsigned NOT NULL AUTO_INCREMENT,
    name varchar(128) NOT NULL,
    bytes varchar(512) NOT NULL,
    content blob,
    username varchar(128) NOT NULL,
    PRIMARY KEY (id),
    UNIQUE KEY name (name)
)";
$malware_result = $conn->query($create_malware);

if (!$malware_result) {
	die($conn->error);
	echo "create malware table failed";
}
$malware_result->close();

// create a contributed malware table
$create_contributed_malware = "CREATE TABLE malwares (
    id smallint(5) unsigned NOT NULL AUTO_INCREMENT,
    name varchar(128) NOT NULL,
    bytes varchar(512) NOT NULL,
    content blob,
    username varchar(128) NOT NULL,
    PRIMARY KEY (id),
    UNIQUE KEY name (name)
)";
$contributed_malware_result = $conn->query($create_contributed_malware);
if (!$contributed_malware_result) {
	die($conn->error);
	echo "create contributed malware table failed";
}
$malware_result->close();

$conn->close();
echo "db inited";

?>