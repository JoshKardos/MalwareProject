
<?php
session_start();
require_once 'mysql_parameter.php';

// connect to database
$db = mysqli_connect($hn, $un, $pw, $db, $port);
if ($db->connect_error) die($db->connect_error);
if (isset($_POST['register_btn'])) {

    $username = mysqli_real_escape_string($db, $_POST['username']);
    $email = mysqli_real_escape_string($db, $_POST['email']);
    $password = mysqli_real_escape_string($db, $_POST['password']);
	$password2 = mysqli_real_escape_string($db, $_POST['password2']);

    if ($password == $password2 && $password != "") {
		// create user
		
		$token = hash('ripemd128', "$salt1$password$salt2");

        $sql = "INSERT INTO users(username, email, password) VALUES('$username', '$email', '$token')";
        mysqli_query($db, $sql);
        $_SESSION['message'] = "You are now logged in";
        $_SESSION['username'] = $username;
        header("location: home.php");
    } elseif(empty($username) || empty($email) || empty($password) || empty($password2)){
        
        $_SESSION['message'] = "There is an empty field!";
        
    }else{
        // failed
        $_SESSION['message'] = "The two passwords do not match";
    }
}
?>


<!DOCTYPE html>
<html>
<head>
<title>Online Virus Check</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div class="header">
		<h1>Online Virus Check</h1>
	</div>
<?php
if (isset($_SESSION['message'])) {
    echo "<div id='error_msg'>" . $_SESSION['message'] . "</div>";
    unset($_SESSION['message']);
}

?>
	<form method="post" action="register.php">
		<table>
			<tr>
				<td>Username:</td>
				<td><input type="text" name="username" class="textInput"></td>
			</tr>

			<tr>
				<td>Email:</td>
				<td><input type="email" name="email" class="textInput"></td>
			</tr>

			<tr>
				<td>Password:</td>
				<td><input type="password" name="password" class="textInput"></td>
			</tr>

			<tr>
				<td>Password:</td>
				<td><input type="password" name="password2" class="textInput"></td>
			</tr>

			<tr>
				<td><a href="login.php">Log In</a></td>
				<td><input type="submit" name="register_btn" value="Register"></td>
			</tr>

		</table>
	</form>



</body>
</html>

